<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.myboot.admin.user.dao.AdminUserDAO">

	<resultMap id="userResult" type="java.util.HashMap">
      <result property="id" column="USER_ID" />
      <result property="pw" column="USER_PW" />
      <result property="name" column="USER_NAME" />
      <result property="email" column="USER_EMAIL" />
      <result property="tel" column="USER_TEL" />
      <result property="tel_sub" column="USER_TEL_SUB" />
      <result property="message" column="USER_MESSAGE" />
      <result property="birth" column="USER_BIRTH" />
      <result property="joinDate" column="JOINDATE" />
      <result property="grade" column="USER_GRADE" />
      <result property="resState" column="RES_STATE" />
   </resultMap> 
	
	<select id="selectAllUserList" resultMap="userResult">
      <![CDATA[
        select U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE, REPLACE(NVL(max(RESERVATION_STATE),'X'),'N','O') RES_STATE
		    from TB_USER U 
		    LEFT JOIN ( select user_id, RESERVATION_STATE from TB_RESERVATION WHERE RESERVATION_STATE='N' ) R
		ON U.user_id = R.user_id 
		GROUP BY U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE
		order by joinDate desc
      ]]>
   </select>
   <!-- 아이디로 검색 -->
	<select id="searchIdUserList" parameterType="String" resultMap="userResult">
      <![CDATA[
        select U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE, REPLACE(NVL(max(RESERVATION_STATE),'X'),'N','O') RES_STATE
		    from TB_USER U 
		    LEFT JOIN ( select user_id, RESERVATION_STATE from TB_RESERVATION WHERE RESERVATION_STATE='N' ) R
		ON U.user_id = R.user_id WHERE U.USER_ID LIKE '%'||#{keyword}||'%'
		GROUP BY U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE
		order by joinDate desc
      ]]>
   </select>
   <!-- 이름으로 검색 -->
	<select id="searchNameUserList" parameterType="String" resultMap="userResult">
      <![CDATA[
        select U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE, REPLACE(NVL(max(RESERVATION_STATE),'X'),'N','O') RES_STATE
		    from TB_USER U 
		    LEFT JOIN ( select user_id, RESERVATION_STATE from TB_RESERVATION WHERE RESERVATION_STATE='N' ) R
		ON U.user_id = R.user_id WHERE USER_NAME LIKE '%'||#{keyword}||'%'
		GROUP BY U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE
		order by joinDate desc
      ]]>
   </select>
   <!-- 전화번호로 검색 -->
	<select id="searchTelUserList" parameterType="String" resultMap="userResult">
      <![CDATA[
        select U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE, REPLACE(NVL(max(RESERVATION_STATE),'X'),'N','O') RES_STATE
		    from TB_USER U 
		    LEFT JOIN ( select user_id, RESERVATION_STATE from TB_RESERVATION WHERE RESERVATION_STATE='N' ) R
		ON U.user_id = R.user_id WHERE USER_TEL LIKE '%'||#{keyword}||'%'
		GROUP BY U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE
		order by joinDate desc
      ]]>
   </select>
   <!-- 이메일로 검색 -->
	<select id="searchEmailUserList" parameterType="String" resultMap="userResult">
      <![CDATA[
        select U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE, REPLACE(NVL(max(RESERVATION_STATE),'X'),'N','O') RES_STATE
		    from TB_USER U 
		    LEFT JOIN ( select user_id, RESERVATION_STATE from TB_RESERVATION WHERE RESERVATION_STATE='N' ) R
		ON U.user_id = R.user_id WHERE USER_EMAIL LIKE '%'||#{keyword}||'%'
		GROUP BY U.USER_ID, USER_NAME, USER_EMAIL, USER_TEL, JOINDATE, USER_GRADE
		order by joinDate desc
      ]]>
   </select>
	
</mapper>